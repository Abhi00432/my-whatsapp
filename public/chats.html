<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app">
  <div class="header">Users</div>
  <div class="list" id="list"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const name = localStorage.getItem("name");

// üî• ‡§Ö‡§ó‡§∞ name ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§§‡•ã ‡§µ‡§æ‡§™‡§∏ join ‡§™‡§∞
if (!name) {
  location.href = "join.html";
}

const socket = io();

// üî• JOIN WITH VALID NAME
socket.emit("join", name);

socket.on("users", users => {
  list.innerHTML = "";

  Object.keys(users).forEach(id => {
    // üî• ‡§Ö‡§¨ ‡§ñ‡•Å‡§¶ ‡§ï‡•ã ‡§∏‡§π‡•Ä ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á hide ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á
    if (users[id] && users[id] !== name) {
      list.innerHTML += `
        <div class="user" onclick="openChat('${id}','${users[id]}')">
          ${users[id]}
        </div>
      `;
    }
  });

  if (!list.innerHTML) {
    list.innerHTML = `<div style="padding:20px;color:#777">No users online</div>`;
  }
});

function openChat(id, user) {
  localStorage.setItem("to", id);
  localStorage.setItem("toName", user);
  location.href = "chat.html";
}
</script>

</body>
</html>
